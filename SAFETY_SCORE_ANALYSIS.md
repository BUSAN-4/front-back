# 안전점수 계산 로직 분석 및 권장사항

## 현재 차이점

### 1. 졸음 감점
- **백엔드**: `duration_sec // 4` (정수 나눗셈), 최대 10점 제한
- **PowerBI**: `duration_sec / 4` (소수점 가능), 제한 없음
- **결론**: 졸음 최대 제한은 제거해도 됨 (사용자 의견 반영)

### 2. 급가속/급감속 감점 (핵심 차이점)

**백엔드 (현재)**:
- 10분 단위로 그룹화
- 각 그룹의 급가속+급감속 합계를 감점
- 예시:
  - 10분 그룹 1 (10:00~10:10): 급가속 5회 + 급감속 3회 = 8점 감점
  - 10분 그룹 2 (10:10~10:20): 급가속 1회 = 1점 감점
  - 총 감점: 9점

**PowerBI (현재)**:
- 단순 합계 사용
- 예시:
  - 급가속 5회 + 급감속 3회 + 급가속 1회 = 9점 감점
  - 총 감점: 9점

## 분석 결과

### 실제 점수 차이
- **대부분의 경우**: 점수가 동일함 (10분 그룹화와 단순 합계가 같은 결과)
- **차이가 나는 경우**: 
  - 같은 10분 안에 급가속과 급감속이 섞여 있을 때
  - 하지만 합계는 동일하므로 점수도 동일

### 10분 그룹화의 의미
- 백엔드 로직을 보면, 10분 그룹화를 해도 **각 그룹의 합계를 그대로 감점**함
- 즉, 그룹화 자체가 감점을 줄이거나 늘리지 않음
- 단지 **시간대별 분석**을 위한 그룹화일 뿐

## 권장사항

### ✅ **PowerBI 방식 (단순 합계)을 권장합니다**

**이유:**
1. **구현이 간단**: DAX에서 10분 단위 그룹화는 복잡함
2. **점수 차이 없음**: 실제로는 같은 결과가 나옴
3. **유지보수 용이**: 로직이 명확하고 이해하기 쉬움
4. **성능**: 단순 합계가 더 빠름

### 수정된 PowerBI DAX (최종 권장)

```dax
session_score = 
VAR no = 100
VAR deacc = CALCULATE(SUM(driving_session_info[app_rapid_deacc]))
VAR acc = CALCULATE(SUM(driving_session_info[app_rapid_acc]))
VAR drowsy = SUMX(drowsy_drive, drowsy_drive[duration_sec] / 4)
VAR score = no - deacc - acc - drowsy
RETURN MAX(score, 0)
```

**변경사항:**
- 졸음 최대 제한 제거 (사용자 요청)
- 급가속/급감속은 단순 합계 유지 (백엔드와 동일한 결과)

### 백엔드 수정 (선택사항)

만약 백엔드도 단순화하고 싶다면:
- 10분 그룹화 로직 제거
- 단순 합계 사용: `rapid_penalty = SUM(app_rapid_acc) + SUM(app_rapid_deacc)`
- 하지만 현재 백엔드 로직도 정상 작동하므로 수정 불필요

## 결론

**PowerBI DAX는 현재 공식이 맞습니다!**
- 졸음 최대 제한만 제거하면 됨 (이미 제거되어 있음)
- 급가속/급감속 단순 합계는 백엔드와 동일한 결과를 만듦
- 추가 수정 불필요



